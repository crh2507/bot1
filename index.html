<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
 <meta name="theme-color" content="#000000"/>
 <title>RayBOT Offline Assistant</title>
 <link rel="manifest" href="manifest.json" />
 <style>
   body { margin: 0; font-family: sans-serif; background: #111; color: #fff; display: flex; flex-direction: column; height: 100vh; }
   header { background: #222; padding: 1em; text-align: center; font-size: 1.2em; font-weight: bold; }
   #chat { flex: 1; padding: 1em; overflow-y: auto; }
   .msg { margin: .5em 0; }
   .user { text-align: right; color: #0f0; }
   .bot { text-align: left; color: #0af; }
   form { display: flex; border-top: 1px solid #333; }
   input { flex: 1; padding: 1em; border: none; font-size: 1em; background: #000; color: #fff; }
   button { background: #333; color: #fff; padding: 1em; border: none; }
 </style>
</head>
<body>
 <header>ðŸ¤– RayBOT Offline Assistant</header>
 <div id="chat"></div>
 <form id="form">
   <input id="input" autocomplete="off" placeholder="Ask me something..." />
   <button>Send</button>
 </form>

 <script>
   const input = document.getElementById('input');
   const chat = document.getElementById('chat');
   const form = document.getElementById('form');

   let history = JSON.parse(localStorage.getItem('chat') || '[]');

   function addMessage(text, sender) {
     const div = document.createElement('div');
     div.className = 'msg ' + sender;
     div.textContent = text;
     chat.appendChild(div);
     chat.scrollTop = chat.scrollHeight;
   }

   function respond(msg) {
     msg = msg.toLowerCase();
     if (msg.includes('hello') || msg.includes('hi')) return "Hi there! How can I help you?";
     if (msg.includes('time')) return `Current time is ${new Date().toLocaleTimeString()}.`;
     if (msg.includes('date')) return `Today's date is ${new Date().toLocaleDateString()}.`;
     if (msg.includes('who are you')) return "I'm RayBOT, your offline assistant.";
     if (msg.includes('help')) return "Try asking about the date, time, or say hello!";
     return "Sorry, I don't understand that yet.";
   }

   function saveHistory() {
     localStorage.setItem('chat', JSON.stringify(history));
   }

   history.forEach(([text, sender]) => addMessage(text, sender));

   form.onsubmit = e => {
     e.preventDefault();
     const text = input.value.trim();
     if (!text) return;
     history.push([text, 'user']);
     addMessage(text, 'user');
     input.value = '';
     const reply = respond(text);
     history.push([reply, 'bot']);
     setTimeout(() => addMessage(reply, 'bot'), 500);
     saveHistory();
   };
 </script>

 <script>
   // Register Service Worker
   if ('serviceWorker' in navigator) {
     const swCode = `
       self.addEventListener('install', e => {
         e.waitUntil(caches.open('raybot').then(cache => {
           return cache.addAll(['./']);
         }));
         self.skipWaiting();
       });
       self.addEventListener('fetch', e => {
         e.respondWith(
           caches.match(e.request).then(response => response || fetch(e.request))
         );
       });
     `;
     const blob = new Blob([swCode], { type: 'application/javascript' });
     const swURL = URL.createObjectURL(blob);
     navigator.serviceWorker.register(swURL);
   }
 </script>

 <script>
   // Inline Manifest (no icon)
   const manifest = {
     name: "RayBOT",
     short_name: "RayBOT",
     start_url: "./",
     display: "standalone",
     background_color: "#000000",
     theme_color: "#000000"
   };
   const blob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
   const manifestURL = URL.createObjectURL(blob);
   document.querySelector('link[rel="manifest"]').setAttribute('href', manifestURL);
 </script>
</body>
</html>
